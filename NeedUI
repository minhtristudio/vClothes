local vClothesUI = {}

-- Services v2
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Tween Info
local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
local fastTween = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

-- Enhanced Color Scheme
local colors = {
    background = Color3.fromRGB(18, 18, 22),
    backgroundSecondary = Color3.fromRGB(22, 22, 26),
    sidebar = Color3.fromRGB(16, 16, 20),
    accent = Color3.fromRGB(88, 101, 242),
    accentHover = Color3.fromRGB(98, 111, 252),
    text = Color3.fromRGB(255, 255, 255),
    textSecondary = Color3.fromRGB(185, 187, 190),
    textDim = Color3.fromRGB(142, 146, 151),
    hover = Color3.fromRGB(35, 35, 40),
    hoverLight = Color3.fromRGB(45, 45, 50),
    border = Color3.fromRGB(55, 55, 60),
    success = Color3.fromRGB(87, 242, 135),
    warning = Color3.fromRGB(255, 202, 40),
    error = Color3.fromRGB(237, 66, 69)
}

function vClothesUI:CreateWindow(title, config)
    config = config or {}
    local window = {}
    window.tabs = {}
    window.activeTab = nil
    window.minimized = false
    window.toggleBoxContainers = {}
    
    -- Tạo ScreenGui
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "vClothesUI_v2"
    screenGui.Parent = playerGui
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- Main Frame (giảm kích thước x3)
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Parent = screenGui
    mainFrame.Size = UDim2.new(0, 187, 0, 137) -- Giảm kích thước x3
    mainFrame.Position = UDim2.new(0.5, -94, 0.5, -69) -- Điều chỉnh vị trí
    mainFrame.BackgroundColor3 = colors.background
    mainFrame.BorderSizePixel = 0
    mainFrame.Active = true
    mainFrame.Draggable = true
    mainFrame.ZIndex = 2
    
    local mainCorner = Instance.new("UICorner")
    mainCorner.CornerRadius = UDim.new(0, 6) -- Bo góc nhỏ hơn
    mainCorner.Parent = mainFrame
    
    -- Title Bar với nút minimize (giảm chiều cao)
    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Parent = mainFrame
    titleBar.Size = UDim2.new(1, 0, 0, 30) -- Giảm chiều cao
    titleBar.BackgroundColor3 = colors.backgroundSecondary
    titleBar.BorderSizePixel = 0
    titleBar.ZIndex = 3
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 6)
    titleCorner.Parent = titleBar
    
    local titleFix = Instance.new("Frame")
    titleFix.Parent = titleBar
    titleFix.Size = UDim2.new(1, 0, 0, 6) -- Giảm kích thước
    titleFix.Position = UDim2.new(0, 0, 1, -6)
    titleFix.BackgroundColor3 = colors.backgroundSecondary
    titleFix.BorderSizePixel = 0
    titleFix.ZIndex = 3
    
    -- Logo/Icon (kích thước nhỏ hơn)
    local logoFrame = Instance.new("Frame")
    logoFrame.Name = "Logo"
    logoFrame.Parent = titleBar
    logoFrame.Size = UDim2.new(0, 20, 0, 20) -- Giảm kích thước
    logoFrame.Position = UDim2.new(0, 5, 0.5, -10) -- Điều chỉnh vị trí
    logoFrame.BackgroundColor3 = colors.accent
    logoFrame.BorderSizePixel = 0
    logoFrame.ZIndex = 4
    
    local logoCorner = Instance.new("UICorner")
    logoCorner.CornerRadius = UDim.new(0, 4) -- Bo góc nhỏ hơn
    logoCorner.Parent = logoFrame
    
    local logoText = Instance.new("TextLabel")
    logoText.Parent = logoFrame
    logoText.Size = UDim2.new(1, 0, 1, 0)
    logoText.BackgroundTransparency = 1
    logoText.Text = "V"
    logoText.TextColor3 = colors.text
    logoText.TextSize = 12 -- Font nhỏ hơn
    logoText.Font = Enum.Font.GothamBold
    logoText.ZIndex = 5
    
    -- Title (font nhỏ hơn)
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Parent = titleBar
    titleLabel.Size = UDim2.new(1, -80, 1, 0) -- Điều chỉnh kích thước
    titleLabel.Position = UDim2.new(0, 25, 0, 0) -- Điều chỉnh vị trí
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title or "vClothes UI"
    titleLabel.TextColor3 = colors.text
    titleLabel.TextSize = 12 -- Font nhỏ hơn
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.ZIndex = 4
    
    -- Control Buttons Container (kích thước nhỏ hơn)
    local controlsFrame = Instance.new("Frame")
    controlsFrame.Parent = titleBar
    controlsFrame.Size = UDim2.new(0, 60, 0, 25) -- Giảm kích thước
    controlsFrame.Position = UDim2.new(1, -65, 0.5, -12.5) -- Điều chỉnh vị trí
    controlsFrame.BackgroundTransparency = 1
    controlsFrame.ZIndex = 4
    
    -- Minimize Button (kích thước nhỏ hơn)
    local minimizeBtn = Instance.new("TextButton")
    minimizeBtn.Name = "MinimizeButton"
    minimizeBtn.Parent = controlsFrame
    minimizeBtn.Size = UDim2.new(0, 25, 0, 20) -- Giảm kích thước
    minimizeBtn.Position = UDim2.new(0, 0, 0.5, -10) -- Điều chỉnh vị trí
    minimizeBtn.BackgroundColor3 = colors.warning
    minimizeBtn.BorderSizePixel = 0
    minimizeBtn.Text = "−"
    minimizeBtn.TextColor3 = colors.text
    minimizeBtn.TextSize = 12 -- Font nhỏ hơn
    minimizeBtn.Font = Enum.Font.GothamBold
    minimizeBtn.ZIndex = 5
    
    local minimizeBtnCorner = Instance.new("UICorner")
    minimizeBtnCorner.CornerRadius = UDim.new(0, 3) -- Bo góc nhỏ hơn
    minimizeBtnCorner.Parent = minimizeBtn
    
    -- Close Button (kích thước nhỏ hơn)
    local closeBtn = Instance.new("TextButton")
    closeBtn.Name = "CloseButton"
    closeBtn.Parent = controlsFrame
    closeBtn.Size = UDim2.new(0, 25, 0, 20) -- Giảm kích thước
    closeBtn.Position = UDim2.new(0, 30, 0.5, -10) -- Điều chỉnh vị trí
    closeBtn.BackgroundColor3 = colors.error
    closeBtn.BorderSizePixel = 0
    closeBtn.Text = "×"
    closeBtn.TextColor3 = colors.text
    closeBtn.TextSize = 14 -- Font nhỏ hơn
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.ZIndex = 5
    
    local closeBtnCorner = Instance.new("UICorner")
    closeBtnCorner.CornerRadius = UDim.new(0, 3) -- Bo góc nhỏ hơn
    closeBtnCorner.Parent = closeBtn
    
    -- Enhanced Sidebar (kích thước nhỏ hơn)
    local sidebar = Instance.new("Frame")
    sidebar.Name = "Sidebar"
    sidebar.Parent = mainFrame
    sidebar.Size = UDim2.new(0, 50, 1, -30) -- Giảm kích thước
    sidebar.Position = UDim2.new(0, 0, 0, 30) -- Điều chỉnh vị trí
    sidebar.BackgroundColor3 = colors.sidebar
    sidebar.BorderSizePixel = 0
    sidebar.ZIndex = 3
    
    local sidebarCorner = Instance.new("UICorner")
    sidebarCorner.CornerRadius = UDim.new(0, 6) -- Bo góc nhỏ hơn
    sidebarCorner.Parent = sidebar
    
    local sidebarFix = Instance.new("Frame")
    sidebarFix.Parent = sidebar
    sidebarFix.Size = UDim2.new(0, 6, 1, 0) -- Giảm kích thước
    sidebarFix.Position = UDim2.new(1, -6, 0, 0)
    sidebarFix.BackgroundColor3 = colors.sidebar
    sidebarFix.BorderSizePixel = 0
    sidebarFix.ZIndex = 3
    
    local sidebarFix2 = Instance.new("Frame")
    sidebarFix2.Parent = sidebar
    sidebarFix2.Size = UDim2.new(1, 0, 0, 6) -- Giảm kích thước
    sidebarFix2.Position = UDim2.new(0, 0, 0, 0)
    sidebarFix2.BackgroundColor3 = colors.sidebar
    sidebarFix2.BorderSizePixel = 0
    sidebarFix2.ZIndex = 3
    
    -- Tab List (kích thước nhỏ hơn)
    local tabList = Instance.new("ScrollingFrame")
    tabList.Name = "TabList"
    tabList.Parent = sidebar
    tabList.Size = UDim2.new(1, -4, 1, -8) -- Giảm kích thước
    tabList.Position = UDim2.new(0, 2, 0, 5) -- Điều chỉnh vị trí
    tabList.BackgroundTransparency = 1
    tabList.BorderSizePixel = 0
    tabList.ScrollBarThickness = 2 -- Thanh cuộn mỏng hơn
    tabList.ScrollBarImageColor3 = colors.accent
    tabList.CanvasSize = UDim2.new(0, 0, 0, 0)
    tabList.ZIndex = 4
    
    local tabListLayout = Instance.new("UIListLayout")
    tabListLayout.Parent = tabList
    tabListLayout.FillDirection = Enum.FillDirection.Vertical
    tabListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    tabListLayout.Padding = UDim.new(0, 4) -- Khoảng cách nhỏ hơn
    
    -- Content Area (kích thước nhỏ hơn)
    local contentArea = Instance.new("Frame")
    contentArea.Name = "ContentArea"
    contentArea.Parent = mainFrame
    contentArea.Size = UDim2.new(1, -55, 1, -35) -- Giảm kích thước
    contentArea.Position = UDim2.new(0, 55, 0, 35) -- Điều chỉnh vị trí
    contentArea.BackgroundTransparency = 1
    contentArea.BorderSizePixel = 0
    contentArea.ZIndex = 3
    
    window.screenGui = screenGui
    window.mainFrame = mainFrame
    window.sidebar = sidebar
    window.tabList = tabList
    window.contentArea = contentArea
    
    -- Minimize/Restore functionality
    local originalSize = mainFrame.Size
    local minimizedSize = UDim2.new(0, 187, 0, 30) -- Kích thước thu nhỏ
    
    minimizeBtn.MouseButton1Click:Connect(function()
        window.minimized = not window.minimized
        
        if window.minimized then
            minimizeBtn.Text = "□"
            TweenService:Create(mainFrame, tweenInfo, {Size = minimizedSize}):Play()
            sidebar.Visible = false
            contentArea.Visible = false
        else
            minimizeBtn.Text = "−"
            TweenService:Create(mainFrame, tweenInfo, {Size = originalSize}):Play()
            wait(0.15)
            sidebar.Visible = true
            contentArea.Visible = true
        end
    end)
    
    closeBtn.MouseButton1Click:Connect(function()
        TweenService:Create(mainFrame, tweenInfo, {Size = UDim2.new(0, 0, 0, 0)}):Play()
        wait(0.3)
        screenGui:Destroy()
    end)
    
    -- Hover effects for buttons
    for _, btn in pairs({minimizeBtn, closeBtn}) do
        btn.MouseEnter:Connect(function()
            TweenService:Create(btn, fastTween, {Size = UDim2.new(0, 27, 0, 22)}):Play()
        end)
        
        btn.MouseLeave:Connect(function()
            TweenService:Create(btn, fastTween, {Size = UDim2.new(0, 25, 0, 20)}):Play()
        end)
    end
    
    -- Tạo Tab với thiết kế tối giản
    function window:CreateTab(name, icon)
        local tab = {}
        tab.name = name
        tab.elements = {}
        tab.toggleBoxes = {}
        
        -- Tab Button với kích thước nhỏ hơn
        local tabBtn = Instance.new("TextButton")
        tabBtn.Name = name .. "Tab"
        tabBtn.Parent = tabList
        tabBtn.Size = UDim2.new(1, 0, 0, 35) -- Giảm chiều cao
        tabBtn.BackgroundColor3 = colors.hover
        tabBtn.BackgroundTransparency = 1
        tabBtn.BorderSizePixel = 0
        tabBtn.Text = ""
        tabBtn.ZIndex = 5
        
        local tabBtnCorner = Instance.new("UICorner")
        tabBtnCorner.CornerRadius = UDim.new(0, 5) -- Bo góc nhỏ hơn
        tabBtnCorner.Parent = tabBtn
        
        -- Tab Icon (kích thước nhỏ hơn)
        local tabIcon = Instance.new("TextLabel")
        tabIcon.Parent = tabBtn
        tabIcon.Size = UDim2.new(0, 15, 0, 15) -- Giảm kích thước
        tabIcon.Position = UDim2.new(0, 5, 0.5, -7.5) -- Điều chỉnh vị trí
        tabIcon.BackgroundTransparency = 1
        tabIcon.Text = icon or "●"
        tabIcon.TextColor3 = colors.textDim
        tabIcon.TextSize = 12 -- Font nhỏ hơn
        tabIcon.Font = Enum.Font.Gotham
        tabIcon.ZIndex = 6
        
        -- Tab Label (font nhỏ hơn)
        local tabLabel = Instance.new("TextLabel")
        tabLabel.Parent = tabBtn
        tabLabel.Size = UDim2.new(1, -25, 1, 0) -- Điều chỉnh kích thước
        tabLabel.Position = UDim2.new(0, 25, 0, 0) -- Điều chỉnh vị trí
        tabLabel.BackgroundTransparency = 1
        tabLabel.Text = name
        tabLabel.TextColor3 = colors.textDim
        tabLabel.TextSize = 10 -- Font nhỏ hơn
        tabLabel.Font = Enum.Font.Gotham
        tabLabel.TextXAlignment = Enum.TextXAlignment.Left
        tabLabel.TextTruncate = Enum.TextTruncate.AtEnd
        tabLabel.ZIndex = 6
        
        -- Active Indicator (mỏng hơn)
        local activeIndicator = Instance.new("Frame")
        activeIndicator.Parent = tabBtn
        activeIndicator.Size = UDim2.new(0, 2, 0, 0) -- Mỏng hơn
        activeIndicator.Position = UDim2.new(0, 0, 0.5, 0)
        activeIndicator.BackgroundColor3 = colors.accent
        activeIndicator.BorderSizePixel = 0
        activeIndicator.ZIndex = 6
        
        local indicatorCorner = Instance.new("UICorner")
        indicatorCorner.CornerRadius = UDim.new(0, 1) -- Bo góc nhỏ hơn
        indicatorCorner.Parent = activeIndicator
        
        -- Tab Content (kích thước nhỏ hơn)
        local tabContent = Instance.new("ScrollingFrame")
        tabContent.Name = name .. "Content"
        tabContent.Parent = contentArea
        tabContent.Size = UDim2.new(1, 0, 1, 0)
        tabContent.BackgroundTransparency = 1
        tabContent.BorderSizePixel = 0
        tabContent.ScrollBarThickness = 2 -- Thanh cuộn mỏng hơn
        tabContent.ScrollBarImageColor3 = colors.accent
        tabContent.CanvasSize = UDim2.new(0, 0, 0, 0)
        tabContent.Visible = false
        tabContent.ZIndex = 4
        
        local contentLayout = Instance.new("UIListLayout")
        contentLayout.Parent = tabContent
        contentLayout.FillDirection = Enum.FillDirection.Vertical
        contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
        contentLayout.Padding = UDim.new(0, 6) -- Khoảng cách nhỏ hơn
        
        local contentPadding = Instance.new("UIPadding")
        contentPadding.PaddingTop = UDim.new(0, 8) -- Giảm padding
        contentPadding.PaddingBottom = UDim.new(0, 8)
        contentPadding.PaddingLeft = UDim.new(0, 8)
        contentPadding.PaddingRight = UDim.new(0, 8)
        contentPadding.Parent = tabContent
        
        tab.button = tabBtn
        tab.content = tabContent
        tab.layout = contentLayout
        tab.icon = tabIcon
        tab.label = tabLabel
        tab.indicator = activeIndicator
        
        -- Tab Click Event
        tabBtn.MouseButton1Click:Connect(function()
            window:SelectTab(tab)
        end)
        
        -- Enhanced Hover Effects
        tabBtn.MouseEnter:Connect(function()
            if window.activeTab ~= tab then
                TweenService:Create(tabBtn, fastTween, {BackgroundTransparency = 0, BackgroundColor3 = colors.hover}):Play()
                TweenService:Create(tabIcon, fastTween, {TextColor3 = colors.textSecondary}):Play()
                TweenService:Create(tabLabel, fastTween, {TextColor3 = colors.textSecondary}):Play()
            end
        end)
        
        tabBtn.MouseLeave:Connect(function()
            if window.activeTab ~= tab then
                TweenService:Create(tabBtn, fastTween, {BackgroundTransparency = 1}):Play()
                TweenService:Create(tabIcon, fastTween, {TextColor3 = colors.textDim}):Play()
                TweenService:Create(tabLabel, fastTween, {TextColor3 = colors.textDim}):Play()
            end
        end)
        
        -- Update canvas size
        contentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            tabContent.CanvasSize = UDim2.new(0, 0, 0, contentLayout.AbsoluteContentSize.Y + 16)
        end)
        
        window.tabs[#window.tabs + 1] = tab
        
        if #window.tabs == 1 then
            window:SelectTab(tab)
        end
        
        tabListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            tabList.CanvasSize = UDim2.new(0, 0, 0, tabListLayout.AbsoluteContentSize.Y + 12)
        end)
        
        -- Enhanced Button (kích thước nhỏ hơn)
        function tab:CreateButton(text, callback)
            local btn = Instance.new("TextButton")
            btn.Name = text .. "Button"
            btn.Parent = tabContent
            btn.Size = UDim2.new(1, 0, 0, 30) -- Giảm chiều cao
            btn.BackgroundColor3 = colors.accent
            btn.BorderSizePixel = 0
            btn.Text = text
            btn.TextColor3 = colors.text
            btn.TextSize = 12 -- Font nhỏ hơn
            btn.Font = Enum.Font.GothamMedium
            btn.ZIndex = 5
            
            local btnCorner = Instance.new("UICorner")
            btnCorner.CornerRadius = UDim.new(0, 5) -- Bo góc nhỏ hơn
            btnCorner.Parent = btn
            
            btn.MouseButton1Click:Connect(function()
                TweenService:Create(btn, TweenInfo.new(0.1), {Size = UDim2.new(1, -2, 0, 28)}):Play()
                wait(0.1)
                TweenService:Create(btn, TweenInfo.new(0.1), {Size = UDim2.new(1, 0, 0, 30)}):Play()
                if callback then callback() end
            end)
            
            btn.MouseEnter:Connect(function()
                TweenService:Create(btn, fastTween, {BackgroundColor3 = colors.accentHover}):Play()
            end)
            
            btn.MouseLeave:Connect(function()
                TweenService:Create(btn, fastTween, {BackgroundColor3 = colors.accent}):Play()
            end)
            
            return btn
        end
        
        -- Enhanced Toggle (kích thước nhỏ hơn)
        function tab:CreateToggle(text, defaultValue, callback)
            local toggleFrame = Instance.new("Frame")
            toggleFrame.Name = text .. "Toggle"
            toggleFrame.Parent = tabContent
            toggleFrame.Size = UDim2.new(1, 0, 0, 30) -- Giảm chiều cao
            toggleFrame.BackgroundColor3 = colors.backgroundSecondary
            toggleFrame.BorderSizePixel = 0
            toggleFrame.ZIndex = 5
            
            local toggleCorner = Instance.new("UICorner")
            toggleCorner.CornerRadius = UDim.new(0, 5) -- Bo góc nhỏ hơn
            toggleCorner.Parent = toggleFrame
            
            local toggleLabel = Instance.new("TextLabel")
            toggleLabel.Parent = toggleFrame
            toggleLabel.Size = UDim2.new(1, -40, 1, 0) -- Điều chỉnh kích thước
            toggleLabel.Position = UDim2.new(0, 8, 0, 0) -- Điều chỉnh vị trí
            toggleLabel.BackgroundTransparency = 1
            toggleLabel.Text = text
            toggleLabel.TextColor3 = colors.text
            toggleLabel.TextSize = 10 -- Font nhỏ hơn
            toggleLabel.Font = Enum.Font.GothamMedium
            toggleLabel.TextXAlignment = Enum.TextXAlignment.Left
            toggleLabel.ZIndex = 6
            
            local toggleBtn = Instance.new("TextButton")
            toggleBtn.Parent = toggleFrame
            toggleBtn.Size = UDim2.new(0, 30, 0, 15) -- Giảm kích thước
            toggleBtn.Position = UDim2.new(1, -35, 0.5, -7.5) -- Điều chỉnh vị trí
            toggleBtn.BackgroundColor3 = defaultValue and colors.accent or colors.border
            toggleBtn.BorderSizePixel = 0
            toggleBtn.Text = ""
            toggleBtn.ZIndex = 6
            
            local toggleBtnCorner = Instance.new("UICorner")
            toggleBtnCorner.CornerRadius = UDim.new(0, 7) -- Bo góc nhỏ hơn
            toggleBtnCorner.Parent = toggleBtn
            
            local toggleIndicator = Instance.new("Frame")
            toggleIndicator.Parent = toggleBtn
            toggleIndicator.Size = UDim2.new(0, 12, 0, 12) -- Giảm kích thước
            toggleIndicator.Position = defaultValue and UDim2.new(0, 17, 0.5, -6) or UDim2.new(0, 1, 0.5, -6)
            toggleIndicator.BackgroundColor3 = colors.text
            toggleIndicator.BorderSizePixel = 0
            toggleIndicator.ZIndex = 7
            
            local indicatorCorner = Instance.new("UICorner")
            indicatorCorner.CornerRadius = UDim.new(0, 6) -- Bo góc nhỏ hơn
            indicatorCorner.Parent = toggleIndicator
            
            local toggled = defaultValue or false
            
            toggleBtn.MouseButton1Click:Connect(function()
                toggled = not toggled
                
                local btnColor = toggled and colors.accent or colors.border
                local indicatorPos = toggled and UDim2.new(0, 17, 0.5, -6) or UDim2.new(0, 1, 0.5, -6)
                
                TweenService:Create(toggleBtn, tweenInfo, {BackgroundColor3 = btnColor}):Play()
                TweenService:Create(toggleIndicator, tweenInfo, {Position = indicatorPos}):Play()
                
                if callback then callback(toggled) end
            end)
            
            return toggleFrame
        end
        
        -- Enhanced Input (kích thước nhỏ hơn)
        function tab:CreateInput(text, placeholder, callback)
            local inputFrame = Instance.new("Frame")
            inputFrame.Name = text .. "Input"
            inputFrame.Parent = tabContent
            inputFrame.Size = UDim2.new(1, 0, 0, 50) -- Giảm chiều cao
            inputFrame.BackgroundTransparency = 1
            inputFrame.BorderSizePixel = 0
            inputFrame.ZIndex = 5
            
            local inputLabel = Instance.new("TextLabel")
            inputLabel.Parent = inputFrame
            inputLabel.Size = UDim2.new(1, 0, 0, 18) -- Giảm chiều cao
            inputLabel.BackgroundTransparency = 1
            inputLabel.Text = text
            inputLabel.TextColor3 = colors.text
            inputLabel.TextSize = 10 -- Font nhỏ hơn
            inputLabel.Font = Enum.Font.GothamMedium
            inputLabel.TextXAlignment = Enum.TextXAlignment.Left
            inputLabel.ZIndex = 6
            
            local inputBox = Instance.new("TextBox")
            inputBox.Parent = inputFrame
            inputBox.Size = UDim2.new(1, 0, 0, 30) -- Giảm chiều cao
            inputBox.Position = UDim2.new(0, 0, 0, 20) -- Điều chỉnh vị trí
            inputBox.BackgroundColor3 = colors.backgroundSecondary
            inputBox.BorderSizePixel = 0
            inputBox.PlaceholderText = placeholder or ""
            inputBox.Text = ""
            inputBox.TextColor3 = colors.text
            inputBox.PlaceholderColor3 = colors.textDim
            inputBox.TextSize = 12 -- Font nhỏ hơn
            inputBox.Font = Enum.Font.Gotham
            inputBox.ClearTextOnFocus = false
            inputBox.ZIndex = 6
            
            local inputCorner = Instance.new("UICorner")
            inputCorner.CornerRadius = UDim.new(0, 5) -- Bo góc nhỏ hơn
            inputCorner.Parent = inputBox
            
            local inputPadding = Instance.new("UIPadding")
            inputPadding.PaddingLeft = UDim.new(0, 8) -- Giảm padding
            inputPadding.PaddingRight = UDim.new(0, 8)
            inputPadding.Parent = inputBox
            
            -- Focus effects
            inputBox.Focused:Connect(function()
                TweenService:Create(inputBox, fastTween, {BackgroundColor3 = colors.hover}):Play()
            end)
            
            inputBox.FocusLost:Connect(function(enterPressed)
                TweenService:Create(inputBox, fastTween, {BackgroundColor3 = colors.backgroundSecondary}):Play()
                if callback then callback(inputBox.Text, enterPressed) end
            end)
            
            return inputBox
        end
        
        -- Enhanced Toggle Box Container với Auto Layout (kích thước nhỏ hơn)
function tab:CreateToggleBoxContainer()
    local containerFrame = Instance.new("Frame")
    containerFrame.Name = "ToggleBoxContainer"
    containerFrame.Parent = tabContent
    containerFrame.Size = UDim2.new(1, 0, 0, 40)
    containerFrame.BackgroundTransparency = 1
    containerFrame.BorderSizePixel = 0
    containerFrame.ZIndex = 5
    
    local containerLayout = Instance.new("UIGridLayout")
    containerLayout.Parent = containerFrame
    containerLayout.CellSize = UDim2.new(0, 50, 0, 25)
    containerLayout.CellPadding = UDim2.new(0, 4, 0, 4)
    containerLayout.SortOrder = Enum.SortOrder.LayoutOrder
    containerLayout.FillDirection = Enum.FillDirection.Horizontal
    containerLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
    containerLayout.VerticalAlignment = Enum.VerticalAlignment.Top
    
    local toggleBoxes = {}
    local toggleCallbacks = {} -- Lưu trữ callback của các toggle box
    
    -- Update container size based on content
    local function updateContainerSize()
        local totalBoxes = #toggleBoxes
        local rows = math.ceil(totalBoxes / 3)
        local newHeight = math.max(40, rows * 29)
        containerFrame.Size = UDim2.new(1, 0, 0, newHeight)
    end
    
    -- Method để điều khiển toggle từ bên ngoài
    local function Set(name, state)
        for _, box in pairs(toggleBoxes) do
            if box.Name == name.."ToggleBox" then
                -- Cập nhật trạng thái UI
                box.BackgroundColor3 = state and colors.accent or colors.backgroundSecondary
                
                -- Gọi callback nếu có
                if toggleCallbacks[name] then
                    toggleCallbacks[name](state)
                end
                break
            end
        end
    end
    
    -- Method để lấy toggle đang được chọn
    local function GetCurrent()
        for name, callback in pairs(toggleCallbacks) do
            for _, box in pairs(toggleBoxes) do
                if box.Name == name.."ToggleBox" and box.BackgroundColor3 == colors.accent then
                    return name
                end
            end
        end
        return nil
    end
    
    -- Method reset tất cả toggle
    local function ResetAll()
        for name, _ in pairs(toggleCallbacks) do
            Set(name, false)
        end
    end
    
    local container = {
        frame = containerFrame,
        layout = containerLayout,
        boxes = toggleBoxes,
        updateSize = updateContainerSize,
        Set = Set,
        GetCurrent = GetCurrent,
        ResetAll = ResetAll
    }
    
    window.toggleBoxContainers[#window.toggleBoxContainers + 1] = container
    return container
end
        
        -- Enhanced Toggle Box với Auto-arrangement (kích thước nhỏ hơn)
        function tab:CreateToggleBox(text, defaultValue, callback, container)
            if not container then
                container = tab:CreateToggleBoxContainer()
            end
            
            local boxBtn = Instance.new("TextButton")
            boxBtn.Name = text .. "ToggleBox"
            boxBtn.Parent = container.frame
            boxBtn.Size = UDim2.new(0, 50, 0, 25) -- Giảm kích thước
            boxBtn.BackgroundColor3 = defaultValue and colors.accent or colors.backgroundSecondary
            boxBtn.BorderSizePixel = 0
            boxBtn.Text = text
            boxBtn.TextColor3 = colors.text
            boxBtn.TextSize = 10 -- Font nhỏ hơn
            boxBtn.Font = Enum.Font.GothamMedium
            boxBtn.TextWrapped = true
            boxBtn.ZIndex = 6
            
            local boxCorner = Instance.new("UICorner")
            boxCorner.CornerRadius = UDim.new(0, 4) -- Bo góc nhỏ hơn
            boxCorner.Parent = boxBtn
            
            local toggled = defaultValue or false
            
            boxBtn.MouseButton1Click:Connect(function()
                toggled = not toggled
                
                local btnColor = toggled and colors.accent or colors.backgroundSecondary
                TweenService:Create(boxBtn, tweenInfo, {BackgroundColor3 = btnColor}):Play()
                
                if toggled then
                    TweenService:Create(boxBtn, TweenInfo.new(0.1), {Size = UDim2.new(0, 52, 0, 27)}):Play()
                    wait(0.1)
                    TweenService:Create(boxBtn, TweenInfo.new(0.1), {Size = UDim2.new(0, 50, 0, 25)}):Play()
                end
                
                if callback then callback(toggled) end
            end)
            
            -- Hover effect
            boxBtn.MouseEnter:Connect(function()
                if not toggled then
                    TweenService:Create(boxBtn, fastTween, {BackgroundColor3 = colors.hover}):Play()
                end
            end)
            
            boxBtn.MouseLeave:Connect(function()
                if not toggled then
                    TweenService:Create(boxBtn, fastTween, {BackgroundColor3 = colors.backgroundSecondary}):Play()
                end
            end)
            
            container.boxes[#container.boxes + 1] = boxBtn
            container.updateSize()
            
            return boxBtn
        end
        
        -- Enhanced Button Switch (Full Width) (kích thước nhỏ hơn)
        function tab:CreateButtonSwitch(text, options, defaultIndex, callback)
            local switchFrame = Instance.new("Frame")
            switchFrame.Name = text .. "Switch"
            switchFrame.Parent = tabContent
            switchFrame.Size = UDim2.new(1, 0, 0, 50) -- Giảm chiều cao
            switchFrame.BackgroundTransparency = 1
            switchFrame.BorderSizePixel = 0
            switchFrame.ZIndex = 5
            
            local switchLabel = Instance.new("TextLabel")
            switchLabel.Parent = switchFrame
            switchLabel.Size = UDim2.new(1, 0, 0, 18) -- Giảm chiều cao
            switchLabel.BackgroundTransparency = 1
            switchLabel.Text = text
            switchLabel.TextColor3 = colors.text
            switchLabel.TextSize = 10 -- Font nhỏ hơn
            switchLabel.Font = Enum.Font.GothamMedium
            switchLabel.TextXAlignment = Enum.TextXAlignment.Left
            switchLabel.ZIndex = 6
            
            local switchBtn = Instance.new("TextButton")
            switchBtn.Parent = switchFrame
            switchBtn.Size = UDim2.new(1, 0, 0, 30) -- Giảm chiều cao
            switchBtn.Position = UDim2.new(0, 0, 0, 20) -- Điều chỉnh vị trí
            switchBtn.BackgroundColor3 = colors.accent
            switchBtn.BorderSizePixel = 0
            switchBtn.TextColor3 = colors.text
            switchBtn.TextSize = 10 -- Font nhỏ hơn
            switchBtn.Font = Enum.Font.GothamMedium
            switchBtn.ZIndex = 6
            
            local switchCorner = Instance.new("UICorner")
            switchCorner.CornerRadius = UDim.new(0, 5) -- Bo góc nhỏ hơn
            switchCorner.Parent = switchBtn
            
            -- Value indicator (kích thước nhỏ hơn)
            local valueFrame = Instance.new("Frame")
            valueFrame.Parent = switchBtn
            valueFrame.Size = UDim2.new(0, 20, 0, 20) -- Giảm kích thước
            valueFrame.Position = UDim2.new(1, -25, 0.5, -10) -- Điều chỉnh vị trí
            valueFrame.BackgroundColor3 = colors.backgroundSecondary
            valueFrame.BorderSizePixel = 0
            valueFrame.ZIndex = 7
            
            local valueCorner = Instance.new("UICorner")
            valueCorner.CornerRadius = UDim.new(0, 4) -- Bo góc nhỏ hơn
            valueCorner.Parent = valueFrame
            
            local valueLabel = Instance.new("TextLabel")
            valueLabel.Parent = valueFrame
            valueLabel.Size = UDim2.new(1, 0, 1, 0)
            valueLabel.BackgroundTransparency = 1
            valueLabel.TextColor3 = colors.text
            valueLabel.TextSize = 10 -- Font nhỏ hơn
            valueLabel.Font = Enum.Font.GothamBold
            valueLabel.ZIndex = 8
            
            local currentIndex = defaultIndex or 1
            local function updateDisplay()
                local currentValue = tostring(options[currentIndex])
                switchBtn.Text = text .. ": " .. currentValue
                valueLabel.Text = tostring(currentIndex)
            end
            
            updateDisplay()
            
            switchBtn.MouseButton1Click:Connect(function()
                currentIndex = currentIndex + 1
                if currentIndex > #options then
                    currentIndex = 1
                end
                
                updateDisplay()
                
                -- Animation
                TweenService:Create(valueFrame, TweenInfo.new(0.1), {Size = UDim2.new(0, 22, 0, 22)}):Play()
                wait(0.1)
                TweenService:Create(valueFrame, TweenInfo.new(0.1), {Size = UDim2.new(0, 20, 0, 20)}):Play()
                
                if callback then callback(options[currentIndex], currentIndex) end
            end)
            
            -- Hover effects
            switchBtn.MouseEnter:Connect(function()
                TweenService:Create(switchBtn, fastTween, {BackgroundColor3 = colors.accentHover}):Play()
                TweenService:Create(valueFrame, fastTween, {BackgroundColor3 = colors.hover}):Play()
            end)
            
            switchBtn.MouseLeave:Connect(function()
                TweenService:Create(switchBtn, fastTween, {BackgroundColor3 = colors.accent}):Play()
                TweenService:Create(valueFrame, fastTween, {BackgroundColor3 = colors.backgroundSecondary}):Play()
            end)
            
            return switchBtn
        end
        
        return tab
    end
    
    -- Enhanced Select Tab Function
    function window:SelectTab(tab)
        for _, t in pairs(self.tabs) do
            t.content.Visible = false
            TweenService:Create(t.button, fastTween, {BackgroundTransparency = 1}):Play()
            TweenService:Create(t.icon, fastTween, {TextColor3 = colors.textDim}):Play()
            TweenService:Create(t.label, fastTween, {TextColor3 = colors.textDim}):Play()
            TweenService:Create(t.indicator, fastTween, {Size = UDim2.new(0, 2, 0, 0)}):Play()
        end
        
        tab.content.Visible = true
        TweenService:Create(tab.button, fastTween, {BackgroundColor3 = colors.hover, BackgroundTransparency = 0}):Play()
        TweenService:Create(tab.icon, fastTween, {TextColor3 = colors.accent}):Play()
        TweenService:Create(tab.label, fastTween, {TextColor3 = colors.text}):Play()
        TweenService:Create(tab.indicator, fastTween, {Size = UDim2.new(0, 2, 0, 25)}):Play()
        
        self.activeTab = tab
    end
    
    -- Toggle Visibility Function
    function window:Toggle()
        if mainFrame.Visible then
            TweenService:Create(mainFrame, tweenInfo, {Position = UDim2.new(0.5, -94, 0.5, -100)}):Play()
            wait(0.2)
            mainFrame.Visible = false
        else
            mainFrame.Visible = true
            TweenService:Create(mainFrame, tweenInfo, {Position = UDim2.new(0.5, -94, 0.5, -69)}):Play()
        end
    end
    
    return window
end

-- Global Toggle Key (F1)
UserInputService.InputBegan:Connect(function(key, gameProcessed)
    if not gameProcessed and key.KeyCode == Enum.KeyCode.F1 then
        for _, gui in pairs(playerGui:GetChildren()) do
            if gui.Name == "vClothesUI_v2" and gui:FindFirstChild("MainFrame") then
                local mainFrame = gui.MainFrame
                if mainFrame.Visible then
                    TweenService:Create(mainFrame, tweenInfo, {Position = UDim2.new(0.5, -94, 0.5, -100)}):Play()
                    wait(0.2)
                    mainFrame.Visible = false
                else
                    mainFrame.Visible = true
                    TweenService:Create(mainFrame, tweenInfo, {Position = UDim2.new(0.5, -94, 0.5, -69)}):Play()
                end
                break
            end
        end
    end
end)

return vClothesUI
